<div class="row">
  <div class="col-md-9">
    <%= sanitize render "/users_menu" %>
    <div class="panel panel-default">
      <div class="panel-heading important">
        <a href="/admin/account/invoices/<%= @invoice.id %>">
          <i class="fa fa-chevron-left"></i>
          Cancel
        </a>
        <%= @invoice.period.begin.strftime("%B, %Y") %> Invoice
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-lg-12">
            <h3>Paying invoice</h3>
            <dl class="dl-horizontal">
              <dt>ID</dt>
              <dd>
                <%= @invoice.friendly_id %>
              </dd>
              <dt>State</dt>
              <dd>
                <%= @invoice.state %>
              </dd>
              <dt>Billing period</dt>
              <dd>
                <%= @invoice.period.begin %> - <%= @invoice.period.end %>
              </dd>
              <dt>Issued on</dt>
              <dd>
                <%= @invoice.issued_on %>
              </dd>
              <dt>Due on</dt>
              <dd>
                <%= @invoice.due_on %>
              </dd>
              <dt>Line items</dt>
              <dd>
                <table id="line_items" class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th> Name </th>
                      <th> Description </th>
                      <th> Quantity </th>
                      <th> Price </th>
                    </tr>
                  </thead>
                  <tbody>
                    <% @invoice.line_items.each do |line_item| %>
                      <tr>
                        <th>
                          <%= line_item.name %>
                        </th>
                        <td>
                          <%= line_item.description %>
                        </td>
                        <td>
                          <%= line_item.quantity %>
                        </td>
                        <td>
                          <%= line_item.currency %> <%= line_item.cost%>
                        </td>
                      </tr>
                      <% end %>
                  </tbody>
                </table>
              </dd>
              <dt>Total cost</dt>
              <dd>
                <strong>
                  <%= @invoice.currency %> <%= @invoice.cost %>
                </strong>
              </dd>
            </dl>
          </div>
        </div>
        <div class="well StripeElementsForm" data-publishable-key="<%= @stripe_publishable_key %>"
          data-client-secret="<%= @client_secret %>" data-line-item="<%= @invoice.line_items.to_json %>"
          data-billing-address="<%= stripe_billing_address_json %>">
          <form id="payment-form">
            <fieldset>
              <div class="form-element col-md-12" id="card-element"></div>
              <div class="form-element col-md-12">
                <input
                  type="text"
                  id="cardholder-name"
                  placeholder="Cardholder's name (optional)"
                />
              </div>
            </fieldset>
            <fieldset>
              <div class="col-md-12">
                <button class="btn btn-primary pull-right" id="submit-payment">
                  <i id="spinner" class="fa fa-spinner fa-spin hidden" />
                  <span>Pay invoice</span>
                </button>
              </div>
              <p class="card-error" id="card-error" role="alert" />
            </fieldset>
          </form>
          <%= form_tag payment_succeeded_admin_account_invoice_path(@invoice), method: :post, id: 'payment-callback-form' %>
        </div>
      </div>
    </div>
  </div>
</div>
<%= javascript_pack_tag 'invoice_payment' %>
