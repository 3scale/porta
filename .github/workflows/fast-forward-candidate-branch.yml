name: Fast-forward master to managed-services
on:
  schedule:
    - cron: '0 7 * * 4'

jobs:
  fast-forward:
    runs-on: ubuntu-latest
    env:
      FROM_BRANCH: "master"
      TO_BRANCH: "managed-services"
      PERIOD_DAYS: 21 # Days
      STARTING_AT: "2022-10-27 00:00:00"
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ env.FROM_BRANCH }}
          fetch-depth: 0
          token: ${{ secrets.FF_CANDIDATE_BRANCH_PAT_TOKEN }}
      - run: |
          if [ $(($(($(date -d 00:00:00 +%s) - $(date -d "${{ env.STARTING_AT }}" +%s))) % $((60 * 60 * 24 * ${{ env.PERIOD_DAYS }})))) == 0 ]; then
            git fetch origin ${{ env.FROM_BRANCH }}:${{ env.TO_BRANCH }}
            git push origin ${{ env.TO_BRANCH }}
          else
            echo "Nothing to do"
          fi
