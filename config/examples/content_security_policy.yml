base: &default
  # Admin portal policy - restrictive but allows unsafe-inline/eval for existing code
  # Dynamically includes RAILS_ASSET_HOST for CDN assets if configured
  admin_portal:
    enabled: true
    report_only: false
    policy: &default_admin_policy
      default_src: ["'self'"]
      script_src: ["'self'", "'unsafe-inline'", "'unsafe-eval'", "<%= ENV['RAILS_ASSET_HOST'] %>"]
      style_src: ["'self'", "'unsafe-inline'", "<%= ENV['RAILS_ASSET_HOST'] %>"]
      font_src: ["'self'", "data:", "<%= ENV['RAILS_ASSET_HOST'] %>"]
      img_src: ["'self'", "data:", "blob:", "https:", "<%= ENV['RAILS_ASSET_HOST'] %>"]
      connect_src: ["*"]
      frame_src: ["'self'"]
      frame_ancestors: ["'none'"]
      object_src: ["'none'"]
      base_uri: ["'self'"]

  # Developer portal policy - permissive defaults for customization
  developer_portal:
    enabled: true
    report_only: false
    policy:
      default_src: ["*", "data:", "mediastream:", "blob:", "filesystem:", "ws:", "wss:", "'unsafe-eval'", "'unsafe-inline'"]

development:
  <<: *default
  admin_portal:
    enabled: true
    report_only: false
    policy:
      <<: *default_admin_policy # Overwrite default policy in development to add webpack as source
      script_src: ["'self'", "'unsafe-inline'", "'unsafe-eval'", "<%= ENV['RAILS_ASSET_HOST'] %>", "localhost:3035", "ws://localhost:3035"]
      style_src: ["'self'", "'unsafe-inline'", "<%= ENV['RAILS_ASSET_HOST'] %>", "localhost:3035", "ws://localhost:3035"]
      font_src: ["'self'", "data:", "<%= ENV['RAILS_ASSET_HOST'] %>", "localhost:3035", "ws://localhost:3035"]
      img_src: ["'self'", "data:", "blob:", "https:", "<%= ENV['RAILS_ASSET_HOST'] %>", "localhost:3035", "ws://localhost:3035"]
      connect_src: ["*", "localhost:3035", "ws://localhost:3035"]

test:
  <<: *default

production:
  <<: *default
